<!DOCTYPE html>
<html>
  <head>
      <title>Lexis</title>
      <meta charset="utf-8">
    </head>
    <body>
      <p>Sie waren sehr stolz auf ihn. Sie alle kamen zu ihm und dankten ihm vielmals. Sie entschuldigten sich auch dafür, dass sie ihn geneckt hatten. Finbo begrüßte allen Dank bescheiden.</p>
      <p>"Meine Freunde", sagte einer der kleinen Fische. "Finbo ist schlau. Er sagte uns, dass wir uns nicht in Gefahr begeben sollten. Natürlich heißt tapfer zu sein nicht, dass man blind in eine Gefahr rennen sollte. Das haben wir heute gelernt. In Zukunft sollten wir nicht so weit weg zum Spielen gehen." Alle stimmten ihm zu.</p>
      <p>"Ja, ja, Finbo ist ein sehr guter Freund. Obwohl wir ihn geneckt haben, kam er uns sofort zu Hilfe, ohne uns böse zu sein", sagten sie.
"Meine Freunde, ihr müsst nirgendwohin gehen um zu spielen. Ich nehme euch mit und zeige euch Dinge, die ihr die ihr noch nie gesehen habt. Das wäre viel interessanter als weit weg zu schwimmen", sagte Finbo.</p>
      <p>Er schwamm mit seinen Freunden hinauf, nah an die Meeresoberfläche. Und dann sagte er seinen Freunden, dass sie sich nacheinander auf seinen Kopf setzen sollten. Und als er seine Fontäne sprühte, wurden sie aus dem Wasser geschossen, hinaus in die schöne Welt. Sie sahen den Himmel, Vögel, die Sonne, Wolken, Schiffe und weit entfernt gelegene Länder.</p>
      <script>

        function parseSentence(selection) {
          let beginning = selection.anchorOffset - 1;
          while (beginning > 0) {
            if (/[\.!?]/.test(selection.anchorNode.data[beginning])) {
              break;
            }
            beginning -= 1;
          }

          let ending = selection.focusOffset;
          while (ending < selection.anchorNode.length) {
            if (/[\.!?]/.test(selection.anchorNode.data[ending])) {
              break;
            }
            ending += 1;
          }

          let sentence = selection.anchorNode.data.substring(beginning, ending + 1);
          sentence = sentence.replace(/^[\.!?][\s]*/, "");

          return sentence;
        }

        document.body.addEventListener('mouseup', _ => {
          let selection = window.getSelection();

          if (selection.anchorOffset !== selection.focusOffset) {
            let word = selection.toString().trim(),
                context = selection.anchorNode.data,
                url = window.location.href;

            let sentence = parseSentence(selection);

            console.log(selection);
            console.log(word);
            console.log(context);
            console.log(sentence);
            console.log(url);
          }
        });

      </script>
    </body>
</html>
